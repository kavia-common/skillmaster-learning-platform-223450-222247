{"is_source_file": true, "format": "Python", "description": "This file defines API routes for managing AI-generated quizzes within a learning platform. It includes endpoints for generating quizzes via OpenAI, retrieving existing quizzes for lessons, and submitting quiz answers. The file also contains schema definitions for request and response models, helper functions for fetching OpenAI generators and the next lesson, and interacts with database models such as Lesson, Activity, and Progress.", "external_files": [".../db/sqlalchemy.py", ".../db/relational_models.py", ".../services/openai_quiz_service.py"], "external_methods": ["get_session", "Lesson.query", "Activity.query", "Progress.query", "OpenAIQuizGenerator.generate_quiz", "datetime.utcnow"], "published": ["router"], "classes": [{"name": "QuizQuestion", "description": "Defines the schema for quiz questions with a prompt, options, and answer index"}, {"name": "GenerateQuizRequest", "description": "Schema for request to generate a quiz for a lesson"}, {"name": "GeneratedQuizResponse", "description": "Schema for the response containing generated quiz details"}, {"name": "SubmitQuizRequest", "description": "Schema for submitting answers to a quiz"}, {"name": "SubmitQuizResponse", "description": "Schema for the grading result after quiz submission"}], "methods": [{"name": "OpenAIQuizGenerator _get_openai_generator()", "description": "Helper to instantiate OpenAIQuizGenerator, raises HTTP 503 if misconfigured", "scope": "", "scopeKind": ""}, {"name": "Optional[Lesson] _get_next_lesson(session, current_lesson: Lesson)", "description": "Helper to find the next lesson after the current one based on order index", "scope": "", "scopeKind": ""}, {"name": "answers_non_empty(cls, v)", "scope": "SubmitQuizRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "generate_quiz(payload: GenerateQuizRequest, session=Depends(get_session))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "get_lesson_quiz(lesson_id: int, session=Depends(get_session))", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "submit_quiz(payload: SubmitQuizRequest, session=Depends(get_session))", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["get_session", "Lesson.query", "Activity.query", "Progress.query", "OpenAIQuizGenerator.generate_quiz", "session.add", "session.commit", "session.refresh"], "search-terms": ["API router", "generate_quiz", "submit_quiz", "lesson_quiz", "OpenAIQuizGenerator", "relational_models", "activity", "progress", "lesson", "API path", "quiz_questions", "pass_score"], "state": 2, "file_id": 44, "knowledge_revision": 145, "git_revision": "962ba3a528b065ca22ab376c9c099363e2151844", "revision_history": [{"134": ""}, {"145": "962ba3a528b065ca22ab376c9c099363e2151844"}], "ctags": [{"_type": "tag", "name": "GenerateQuizRequest", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^class GenerateQuizRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "GeneratedQuizResponse", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^class GeneratedQuizResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "QuizQuestion", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^class QuizQuestion(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SubmitQuizRequest", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^class SubmitQuizRequest(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "SubmitQuizResponse", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^class SubmitQuizResponse(BaseModel):$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "_get_next_lesson", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^def _get_next_lesson(session, current_lesson: Lesson) -> Optional[Lesson]:$/", "language": "Python", "typeref": "typename:Optional[Lesson]", "kind": "function", "signature": "(session, current_lesson: Lesson)"}, {"_type": "tag", "name": "_get_openai_generator", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^def _get_openai_generator() -> OpenAIQuizGenerator:$/", "language": "Python", "typeref": "typename:OpenAIQuizGenerator", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "activity_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    activity_id: int = Field(..., description=\"Created quiz activity id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GeneratedQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "activity_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    activity_id: int = Field(..., description=\"Quiz activity id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SubmitQuizRequest", "scopeKind": "class"}, {"_type": "tag", "name": "activity_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    activity_id: int = Field(..., description=\"Quiz activity id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "answerIndex", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    answerIndex: int = Field(..., ge=0, le=3, description=\"Index into options array (0..3)\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "QuizQuestion", "scopeKind": "class"}, {"_type": "tag", "name": "answers", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    answers: List[int] = Field(..., description=\"Array of selected option indices corresponding /", "language": "Python", "typeref": "typename:List[int]", "kind": "variable", "scope": "SubmitQuizRequest", "scopeKind": "class"}, {"_type": "tag", "name": "answers_non_empty", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    def answers_non_empty(cls, v):$/", "language": "Python", "kind": "member", "signature": "(cls, v)", "scope": "SubmitQuizRequest", "scopeKind": "class"}, {"_type": "tag", "name": "correct", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    correct: int = Field(..., description=\"Number of correct answers\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "difficulty", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    difficulty: Optional[str] = Field(\"Beginner\", description=\"Optional prompt hint\")$/", "language": "Python", "typeref": "typename:Optional[str]", "kind": "variable", "scope": "GenerateQuizRequest", "scopeKind": "class"}, {"_type": "tag", "name": "generate_quiz", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^async def generate_quiz(payload: GenerateQuizRequest, session=Depends(get_session)):$/", "language": "Python", "kind": "function", "signature": "(payload: GenerateQuizRequest, session=Depends(get_session))"}, {"_type": "tag", "name": "get_lesson_quiz", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^def get_lesson_quiz(lesson_id: int, session=Depends(get_session)):$/", "language": "Python", "kind": "function", "signature": "(lesson_id: int, session=Depends(get_session))"}, {"_type": "tag", "name": "lesson_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    lesson_id: int = Field(..., description=\"Lesson id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GeneratedQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "lesson_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    lesson_id: int = Field(..., description=\"Lesson id\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "lesson_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    lesson_id: int = Field(..., description=\"Numeric lesson ID to generate quiz for\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "GenerateQuizRequest", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "options", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    options: List[str] = Field(..., min_items=4, max_items=4, description=\"Exactly four options\"/", "language": "Python", "typeref": "typename:List[str]", "kind": "variable", "scope": "QuizQuestion", "scopeKind": "class"}, {"_type": "tag", "name": "pass_score", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    pass_score: float = Field(70.0, ge=0, le=100, description=\"Score required to pass\\/unlock ne/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "GenerateQuizRequest", "scopeKind": "class"}, {"_type": "tag", "name": "passed", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    passed: bool = Field(..., description=\"Whether passed per quiz_pass_score\")$/", "language": "Python", "typeref": "typename:bool", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "question", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    question: str = Field(..., description=\"Question prompt\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "QuizQuestion", "scopeKind": "class"}, {"_type": "tag", "name": "quiz_pass_score", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    quiz_pass_score: float = Field(..., description=\"Pass score\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "GeneratedQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "quiz_questions", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    quiz_questions: List[QuizQuestion] = Field(..., min_items=3, max_items=3, description=\"Gener/", "language": "Python", "typeref": "typename:List[QuizQuestion]", "kind": "variable", "scope": "GeneratedQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "router", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^router = APIRouter($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "score", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    score: float = Field(..., description=\"Score percentage 0..100\")$/", "language": "Python", "typeref": "typename:float", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "submit_quiz", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^def submit_quiz(payload: SubmitQuizRequest, session=Depends(get_session)):$/", "language": "Python", "kind": "function", "signature": "(payload: SubmitQuizRequest, session=Depends(get_session))"}, {"_type": "tag", "name": "title", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    title: str = Field(..., description=\"Quiz activity title\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "GeneratedQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "total_questions", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    total_questions: int = Field(..., description=\"Total number of questions\")$/", "language": "Python", "typeref": "typename:int", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "unlocked_next_lesson_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    unlocked_next_lesson_id: Optional[int] = Field(None, description=\"Unlocked next lesson id if/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "variable", "scope": "SubmitQuizResponse", "scopeKind": "class"}, {"_type": "tag", "name": "user_id", "path": "/home/kavia/workspace/code-generation/skillmaster-learning-platform-223450-222247/backend/src/api/routers/quiz_ai.py", "pattern": "/^    user_id: str = Field(..., description=\"User taking the quiz\")$/", "language": "Python", "typeref": "typename:str", "kind": "variable", "scope": "SubmitQuizRequest", "scopeKind": "class"}], "hash": "fb5a6a63eec10ae5a495fa238fdebe43", "format-version": 4, "code-base-name": "backend", "filename": "backend/src/api/routers/quiz_ai.py", "fields": [{"name": "int activity_id", "scope": "GeneratedQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int answerIndex", "scope": "QuizQuestion", "scopeKind": "class", "description": "unavailable"}, {"name": "List[int] answers", "scope": "SubmitQuizRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "int correct", "scope": "SubmitQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[str] difficulty", "scope": "GenerateQuizRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "int lesson_id", "scope": "GeneratedQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "List[str] options", "scope": "QuizQuestion", "scopeKind": "class", "description": "unavailable"}, {"name": "float pass_score", "scope": "GenerateQuizRequest", "scopeKind": "class", "description": "unavailable"}, {"name": "bool passed", "scope": "SubmitQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str question", "scope": "QuizQuestion", "scopeKind": "class", "description": "unavailable"}, {"name": "float quiz_pass_score", "scope": "GeneratedQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "List[QuizQuestion] quiz_questions", "scope": "GeneratedQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "router = APIRouter(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "float score", "scope": "SubmitQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str title", "scope": "GeneratedQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "int total_questions", "scope": "SubmitQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "Optional[int] unlocked_next_lesson_id", "scope": "SubmitQuizResponse", "scopeKind": "class", "description": "unavailable"}, {"name": "str user_id", "scope": "SubmitQuizRequest", "scopeKind": "class", "description": "unavailable"}]}